/**
 * è‡ªåŠ¨ç”Ÿæˆ sidebars.js
 * æ‰«æ reports ç›®å½•ï¼Œè‡ªåŠ¨æ·»åŠ æ‰€æœ‰æŠ¥å‘Šåˆ°ä¾§è¾¹æ 
 */

const fs = require('fs');
const path = require('path');

const reportsDir = path.join(__dirname, '..', 'reports');
const sidebarsPath = path.join(__dirname, '..', 'sidebars.js');

function getReportStructure() {
  const structure = {};
  
  if (!fs.existsSync(reportsDir)) {
    console.log('Reports directory not found');
    return null;
  }
  
  const years = fs.readdirSync(reportsDir)
    .filter(f => fs.statSync(path.join(reportsDir, f)).isDirectory())
    .sort().reverse();
  
  for (const year of years) {
    const yearDir = path.join(reportsDir, year);
    structure[year] = {};
    
    const months = fs.readdirSync(yearDir)
      .filter(f => fs.statSync(path.join(yearDir, f)).isDirectory())
      .sort().reverse();
    
    for (const month of months) {
      const monthDir = path.join(yearDir, month);
      const reports = fs.readdirSync(monthDir)
        .filter(f => f.endsWith('.md'))
        .map(f => f.replace('.md', ''))
        .sort().reverse();
      
      if (reports.length > 0) {
        structure[year][month] = reports;
      }
    }
  }
  
  return structure;
}

function getMonthName(month) {
  const names = {'01':'1æœˆ','02':'2æœˆ','03':'3æœˆ','04':'4æœˆ','05':'5æœˆ','06':'6æœˆ',
                 '07':'7æœˆ','08':'8æœˆ','09':'9æœˆ','10':'10æœˆ','11':'11æœˆ','12':'12æœˆ'};
  return names[month] || month;
}

function generateSidebarItems(structure) {
  const items = [];
  
  for (const [year, months] of Object.entries(structure)) {
    const yearItems = [];
    
    for (const [month, reports] of Object.entries(months)) {
      yearItems.push({
        type: 'category',
        label: getMonthName(month),
        items: reports.map(r => `${year}/${month}/${r}`),
      });
    }
    
    yearItems.sort((a, b) => parseInt(b.label) - parseInt(a.label));
    items.push({ type: 'category', label: `${year}å¹´`, items: yearItems });
  }
  
  return items;
}

function main() {
  console.log('ğŸ” Scanning reports...');
  const structure = getReportStructure();
  
  if (!structure || Object.keys(structure).length === 0) {
    console.log('âš ï¸ No reports found');
    return;
  }
  
  const sidebarItems = generateSidebarItems(structure);
  const content = `// Auto-generated by generate-sidebar.js
/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */
const sidebars = {
  reportsSidebar: ${JSON.stringify(sidebarItems, null, 2)},
};
export default sidebars;
`;

  fs.writeFileSync(sidebarsPath, content);
  console.log('âœ… Sidebar generated!');
}

main();
